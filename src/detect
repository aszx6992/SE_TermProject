import java.io.*;
import java.util.*;

// Detect line and list
public class Detect {
	private boolean stillInList;
	private boolean justNested;
	private boolean nestedWithSymbol;
	
	Detect(){
		stillInList = false;
		justNested = false;
		nestedWithSymbol = false;
	}
	
	public boolean getStillInList(){
		return stillInList;
	}
	
	public boolean getJustNested(){
		return justNested;
	}
	
	public boolean getNestedWithSymbol(){
		return nestedWithSymbol;
	}
	
	// chk whether 'buffer' is line or not. If 'buffer' is a line, then return true.
	public boolean isLine(String buffer){
		// return true in cases of line, such as '=====' or '- - -' or '----'. 
		if(buffer.charAt(0) == '=' 
				|| (buffer.charAt(0) == '-' && buffer.charAt(2) == '-')
				|| (buffer.charAt(0) == '-' && buffer.charAt(1) == '-')){
			return true;
		// return false if 'buffer' is not a line.
		}else{
			return false;
		}
	}
	
	// chk whether 'buffer' is list or not. If 'buffer' is a list, then return true.
	public boolean isList(String buffer){
		
		// start new list
		if(!this.stillInList){
			// list Check
			return this.listCheck(buffer);	
		}
		// continue list
		else if(this.stillInList && this.justNested == false && this.nestedWithSymbol == false){
			// list Check
			return this.listCheck(buffer);
		}
		// nested list check
		else{
			// list Check
			return this.listCheck(buffer);
		}
	}
	
	public boolean listCheck(String buffer){
		// List check
		// return true in case '+'
		if(buffer.charAt(0) == '+'){
			System.out.println("List : " + buffer.charAt(0));
			this.initBoolean();
			this.stillInList = true;
			this.printBoolean();
			return true;
		}
		// return true in case '*'
		else if(buffer.charAt(0) == '*'){
			int starNum = 0;
						
			// chk whether '*' at charAt(0) is bold symbol or list symbol
			for(int i=0; i<buffer.length(); i++){
				if(buffer.charAt(i) == '*')
					starNum++;
			}
			// If starNum is odd, then '*' at charAt(0) is list symbol and so return true.
			if(starNum % 2 == 1){
				System.out.println("List : " + buffer.charAt(0));
				this.initBoolean();
				this.stillInList = true;
				this.printBoolean();
				return true;	
			}
					
			// If starNum is even, then '*' at charAt(0) is bold symbol
			else{
				this.printBoolean();
				return false;
			}
		}
		// return true if case '-'
		else if(buffer.charAt(0) == '-'){
			// 라인 체크에서 이미 '---'와 '- -'를 걸렀기 때문에 무조건 리스트임.
			System.out.println("List : " + buffer.charAt(0));
			this.initBoolean();
			this.stillInList = true;
			this.printBoolean();
			return true;
		}
		System.out.println("No case in list check. So do nestedCheck");
		return this.nestedCheck(buffer);
	}
	
	public boolean nestedCheck(String buffer){
		// nested check
		if(buffer.charAt(0) == ' ' && buffer.charAt(1) == ' '){
			// check having symbol or not
			if(buffer.charAt(2) == '-' || buffer.charAt(2) == '+'){
				// nested with symbol
				System.out.println("nested with symbol : " + buffer.charAt(2));
				this.initNestedBoolean();
				this.nestedWithSymbol = true;
				this.printBoolean();
				return true;
			}else{
				// just nested
				System.out.println("just nested");
				this.initNestedBoolean();
				this.justNested = true;
				this.printBoolean();
				return true;
			}
		}
		// list end.
		else{
			System.out.println("No case in nested test. maybe this is not line or list.");
			this.initBoolean();
			this.printBoolean();
			return false;
		}
	}
	
	// Transform MD to HTML
	public String transformToHTML(String result, int option){
		
		switch(option){
		// new list
		case 0 :
			result = "<li>" + result.substring(2) + "</li>";
			return result;
		// just nested list
		case 1 :
			result = "  " + result.substring(2);
			return result;
		// nested list with symbol
		case 2 :
			result = "<ul><li>" + result.substring(4) + "</li></ul>";
			return result;
		}
		
		System.out.println("Error case in transformToHTML");
		return "Error in transforming";
	}
	
	public void initBoolean(){
		this.stillInList = false;
		this.justNested = false;
		this.nestedWithSymbol = false;
	}
	
	public void initNestedBoolean(){
		this.justNested = false;
		this.nestedWithSymbol = false;
	}
	
	public void printBoolean(){
		System.out.println("Boolean value : stillInList=" + this.stillInList + ", justNested=" + this.justNested + ", nestedWithSymbol=" + this.nestedWithSymbol);
	}
	
}
